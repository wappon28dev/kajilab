# ã‚¿ã‚¤ãƒˆãƒ«

## å‡ºå¸­ç‡

- 3 å¹´ã‚»ãƒŸãƒŠãƒ¼ï¼š?? %

## ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

### çŸ­æœŸçš„ãªäºˆå®š

- [ ] ?/?ã¾ã§ã«ã€‡ã€‡ã™ã‚‹
- [ ] ?/?ã¾ã§ã«ã€‡ã€‡ã™ã‚‹
- [ ] ?/?ã¾ã§ã«ã€‡ã€‡ã™ã‚‹

### é•·æœŸçš„ãªäºˆå®š

- 8/15 ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢å®Œæˆ
- 8/25 ä½œå“ç´¹ä»‹å‹•ç”»ã®åˆ¶ä½œå®Œäº†, ProtoPedia åŸ·ç­†å®Œäº†
- 8/31 U-22 ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚³ãƒ³ãƒ†ã‚¹ãƒˆä½œå“æå‡º

## é€²æ—å ±å‘Š

å‰å›ã¯, ã¡ã‚‡ã£ã¨ã—ãŸ UI ã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‚’è€ƒãˆã¦, æŠ€è¡“é¸å®šã‚’é€²ã‚ãŸ. ä»Šå›ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹ç¯‰ã‚’ä¸»ã«è¡Œã£ã¦ã„ã.

ä»Šä¸€åº¦ã‚´ãƒ¼ãƒ«ã‚’å†ç¢ºèª (å®šæœŸ):

> - â˜… ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåˆ¶ä½œç‰©ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’ç†è§£ã—, å¾“ã„ã‚„ã™ãã™ã‚‹ä»•çµ„ã¿ã‚’ä½œã‚‹ (è¡Œå‹•å¤‰å®¹)
>   - åˆ¶ä½œç‰©ã®è¨±è«¾ç¯„å›²ã®ç°¡æ˜“ä¸€è¦§ã‚’ç¢ºèªã§ãã‚‹
>   - ãƒ©ã‚¤ã‚»ãƒ³ã‚¹å…¨æ–‡ã‚’ç¢ºèªã§ãã‚‹
>   - ä½œå“ã«å«ã¾ã‚Œã‚‹ç´ æã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã«å¾“ã†ãŸã‚ã®æƒ…å ±ã‚’å¾—ã‚‰ã‚Œã‚‹ (ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆè¡¨è¨˜ã®ã‚³ãƒ”ãƒ¼ ãªã©)
>
> ãã®ãŸã‚ã«, ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ãŒ...
>
> - è‡ªèº«ã®ä½œå“ã«å¯¾ã—ã¦ç°¡å˜ã«ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’é¸æŠ/ç”Ÿæˆã§ãã‚‹
> - å¿…è¦ã«å¿œã˜ã¦ç‰¹è¨˜äº‹é …ã‚’è¿½åŠ ã§ãã‚‹

### æŠ€è¡“é¸å®š

<img width="914.25" alt="image.png (125.4 kB)" src="https://img.esa.io/uploads/production/attachments/13979/2024/06/04/163736/2a1dd44f-786c-4943-99d0-50efc8204119.png">

<p style="font-size: 2rem; font-weight: bold">
â†’ ...Tauri ã«æ±ºå®šï¼
</p

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹ç¯‰

- Tauri + Vite + React

ã“ã“ã‹ã‚‰ã¯ã‚´ãƒ¼ãƒ«ã«å¯¾ã—ã¦ã‚ãã¾ã§ â€œæ‰‹æ®µâ€ ã®ãŠè©±ã«ãªã‚‹ãŒ, çŸ¥è¦‹ã®ãŸã‚ã«, èº“ã„ãŸã¨ã“ã‚ã‚’ãƒ¡ãƒ¢ã—ã¦ãŠã.

### å•é¡Œç‚¹

ã‚ˆï½ã—. `src-tauri/src/main.rs` ã«ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã—ã¦ã¿ã‚‹ã‚ˆ. ã“ã‚ŒãŒãƒ‡ãƒ¢ã‚³ãƒ¼ãƒ‰ã‹ï½.

```rs
// ...

#[tauri::command]
fn greet(name: &str) -> String {
    format!("Hello, {}! You've been greeted from Rust!", name)
}

fn main() {
    tauri::Builder::default()
        .invoke_handler(tauri::generate_handler![greet])
        .run(tauri::generate_context!())
        .expect("error while running tauri application");
}
```

`invoke_handler` ã«ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦, JavaScript (WebView) å´ã‹ã‚‰ Rust ã§è¨˜è¿°ã—ãŸé–¢æ•°ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã‚‹.

```ts
import { invoke } from "@tauri-apps/api";

const greet = async () => {
  return await invoke("get_app_name");
  //           ^? Promise<any>
};
```

ãã†. åˆæœŸã®å ´åˆã ã¨, `invoke` ã—ãŸå‹ã¯, `Promise<any>` ã«ãªã£ã¦ã—ã¾ã„å‹ãŒå–ã‚Œãªã„. æ‚²ã—ã„.  
ã¾ãŸ, `invoke` ã«æ¸¡ã™å¼•æ•° (ã‚³ãƒãƒ³ãƒ‰ã®åç§°) ã‚‚ `string` ã§ã‚ã‚Œã°ä½•ã§ã‚‚å…¥ã£ã¦ã—ã¾ã†ã®ã§, ãã®ã‚³ãƒãƒ³ãƒ‰ãŒå­˜åœ¨ã™ã‚‹ã‹ã‚‚ã‚ã‹ã‚‰ãªã„. ã“ã‚Œã‚‚æ‚²ã—ã„.

<img width="762" alt="image.png (121.9 kB)" src="https://img.esa.io/uploads/production/attachments/13979/2024/06/04/163736/156dff7f-9c94-4803-9712-8ce1d45f9774.png">

GitHub Issues ã®ã‚³ãƒ¡ãƒ³ãƒˆ [^1] ã«ã‚ˆã‚‹ã¨, ã©ã†ã‚„ã‚‰ Rust ã® RPC ãŒã‚ã£ã¦, rspc ã¨ã„ã†ã‚¯ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ãˆã°ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã¨ WebView ãƒ—ãƒ­ã‚»ã‚¹ã§ä»²è‰¯ãé€šä¿¡ãŒã§ãã‚‹ã‚‰ã—ã„.

<img width="694.5" alt="image.png (21.2 kB)" src="https://img.esa.io/uploads/production/attachments/13979/2024/06/04/163736/9804807b-75bd-4aaf-9199-9f3d25adeca7.png">

(è„³å†…å¤‰æ›ä¸­...)

```rs
let router = <rspc::Router>::new()
    .query("version", |t| {
      t(|ctx, input: ()| "0.0.1")
    })
    /*
    ->  .query("version", (t) => t((ctx, input: {}) => "0.0.1")
    */
    .mutation("helloWorld", |t| {
      t(|ctx, input: ()| async { "Hello World!" })
    });
    /*
    ->  .mutation("helloWorld", (t) => t(async (ctx, input: {}) => "Hello World!")
    */
```

`|t|` ã¨ã‹ `(())` ã¨ã‹ã¯å¾Œã€…æ…£ã‚Œã‚‹ã¨ã—ã¦, ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ Tauri ã§ä½¿ã£ã¦ã¿ã‚ˆã†.  
Tuari + rspc ã®è¨˜äº‹ã¯, æ—¥æœ¬èªã¨è‹±èªãŒãƒ’ãƒƒãƒˆã—ãŸãŒ, å°‘ã—ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤ã‹ã£ãŸã®ã§å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å½“ãŸã£ã¦ã¿ãŸ:

<img width="1167" alt="image.png (148.9 kB)" src="https://img.esa.io/uploads/production/attachments/13979/2024/06/04/163736/d2fc3107-e848-4687-b6da-5900f279f5fb.png">

ãªã‚“ã§ã‚„ï¼ `main.rs` ãŒã“ã‚“ãªçŸ­ã„ã‚ã‘ãŒãªã„ã‚„ã‚ï¼
ã™ã§ã«ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ã¨é ‘å¼µã£ã¦ãƒãƒ¼ã‚¸ã—ã¦ã„ã£ãŸ.

```log
thread 'main' panicked at 'there is no reactor running, must be called from the context of Tokio runtime'
```

ç°¡å˜ã«ã¯ã„ã‹ãªã‹ã£ãŸãŒ, 40 åˆ†ãã‚‰ã„æ ¼é—˜ã—ãŸã‚‰ã„ã‘ãŸï¼ˆçµå±€ `Tokio` ã£ã¦ãªã‚“ã ã£ãŸã‚“ã ï¼Ÿï¼‰.  
WebView å´ã®æº–å‚™ (ESLint + PandaCSS + generouted ãªã©) ã‚‚æ•´ã£ãŸã®ã§, æ¥é€±ã‹ã‚‰ã¯æœ¬æ ¼çš„ãª UI ã®å®Ÿè£…ã«å…¥ã£ã¦ã„ã‘ãã†ã .

å®Œæˆå½¢:

`src-tauri/src/main.rs`

```rs
// Prevents additional console window on Windows in release, DO NOT REMOVE!!
#![cfg_attr(not(debug_assertions), windows_subsystem = "windows")]

use rspc::Router;

fn router() -> Router<()> {
    <Router>::new()
        .config(rspc::Config::new().export_ts_bindings("../src/types/bindings.d.ts"))
        // â†‘ ã§ `/src/types/bindings.d.ts` ã«æ¬¡ã«ç¶šã Query ãªã©ã®æˆ»ã‚Šå€¤ã®å‹ãªã©ãŒç”Ÿæˆã•ã‚Œã‚‹
        .query("version", |t| {
            t(|_ctx, _input: ()| env!("CARGO_PKG_VERSION"))
        })
        .query("hello", |t| t(|_ctx, _input: ()| "Hello, World!"))
        .build()
}

#[tokio::main]
async fn main() {
    let router = router();

    tauri::Builder::default()
        .plugin(rspc_tauri::plugin(router.arced(), |_app_handle| ()))
        .run(tauri::generate_context!())
        .expect("error while running tauri application");
}
```

`src/lib/services/rpc.ts`

```ts
import { createClient } from "@rspc/client";
import { TauriTransport } from "@rspc/tauri";
import { type Procedures } from "@/types/bindings";

export const api = createClient<Procedures>({
  transport: new TauriTransport(),
});

// api.query(["version"]).then((res) => console.log(res));
//                      ^? Promise<string> ğŸ˜Š
```

ã“ã‚Œã§ãšã„ã¶ã‚“ã¨ã‚³ãƒ¼ãƒ‰ã®è¦‹é€šã—ãŒè‰¯ããªã£ãŸ. ã“ã‚Œã‹ã‚‰ã¯, ã“ã®æ§‹æˆã§ UI ã‚’å®Ÿè£…ã—ã¦ã„ã.

## ä½™è«‡

- Typst ã§æƒ…å ±å€«ç†ã®ä¸­é–“ãƒ†ã‚¹ãƒˆã®å…¬å¼ãƒãƒ¼ãƒˆã‚·ãƒ¼ãƒˆã‚’ä½œæˆã™ã‚‹ â†’ æå‡ºãŒæ‰‹æ›¸ããªæ•…ã«è‹¦ç—›ãªã‚Š ğŸ™ƒ

[^1]: <https://github.com/tauri-apps/tauri/issues/1514#issuecomment-1619337304>
